<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Aliev's page</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/style.css">
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div class="language-switch" aria-label="Language switch">
                <button type="button" data-lang="ru">RU</button>
                <span>/</span>
                <button type="button" data-lang="en">EN</button>
            </div>
        </div>
        <main>
            {{ content }}
        </main>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const storageKey = "preferredLanguage";
            const defaultLang = "ru";
            const localeUrl = "{{ site.baseurl }}/locale.json";
            const switcher = document.querySelector(".language-switch");
            const buttons = switcher ? switcher.querySelectorAll("button[data-lang]") : [];
            let translations = null;

            const setActiveLanguage = (lang) => {
                buttons.forEach((button) => {
                    button.classList.toggle("active", button.dataset.lang === lang);
                });
                document.documentElement.lang = lang;
            };

            const applyTranslations = (lang) => {
                if (!translations) return;
                const strings = translations[lang] || translations[defaultLang];
                if (!strings) return;
                document.querySelectorAll("[data-i18n]").forEach((element) => {
                    const key = element.getAttribute("data-i18n");
                    const value = strings[key];
                    if (value === undefined) return;
                    const attr = element.getAttribute("data-i18n-attr");
                    if (attr) {
                        element.setAttribute(attr, value);
                    } else {
                        element.innerHTML = value;
                    }
                });
            };

            const initLocalization = async () => {
                try {
                    const response = await fetch(localeUrl, { cache: "no-store" });
                    if (!response.ok) throw new Error("Failed to load locale.json");
                    translations = await response.json();
                } catch (error) {
                    console.error("Localization load failed:", error);
                    return;
                }

                const saved = localStorage.getItem(storageKey);
                const initialLang = saved && translations[saved] ? saved : defaultLang;
                setActiveLanguage(initialLang);
                applyTranslations(initialLang);

                buttons.forEach((button) => {
                    button.addEventListener("click", () => {
                        const nextLang = button.dataset.lang;
                        localStorage.setItem(storageKey, nextLang);
                        setActiveLanguage(nextLang);
                        applyTranslations(nextLang);
                    });
                });
            };

            initLocalization();
            document.querySelectorAll("a[href]").forEach((link) => {
                link.setAttribute("target", "_blank");
                link.setAttribute("rel", "noopener noreferrer");
            });
        });
    </script>
</body>
</html> 